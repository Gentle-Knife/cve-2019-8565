# cve-2019-8565

基于 pid 的 Security check，比如 sandbox_check 和 SecTaskCreateWithPID，还有 xpc server 中使用 xpc_connection_get_pid 和 [NSXPCConnection processIdentifier] 认证 xpc client 都是有问题的。先发送大量 xpc message 阻塞队列，再利用 posix_spawn 或者 fork + execve 重用 pid 运行合法的 xpc client 与认证过程 race，达到 bypass 认证的目的。

应该使用 audit_token_t 一类的认证方法，但是 xpc_connection_get_audit_token 和 [NSXPCConnection auditToken] 都是私有方法，作为开发者很蛋碎。

[参考](https://medium.com/0xcc/rootpipe-reborn-part-ii-e5a1ffff6afe)
